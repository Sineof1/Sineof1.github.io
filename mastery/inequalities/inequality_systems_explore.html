<!DOCTYPE html>
<html>
<head>
<meta charset = 'utf-8'>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:image" content='https://guzintamath.com/textsavvy/wp-content/uploads/2019/01/ineqsystems.png'>
<link rel='icon' href='cl_logo.jpg' />
<script src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.js'></script>
<title>Inequalities Explore</title>

<style>
@font-face {
    font-family: "Product Sans";
    src: url(GoogleSans-Regular.ttf) format("truetype");
}
#demo_grapher {
  position:absolute;
  top:50px;
  left:424px;
  width:625px;
  height:550px;
  border:1px solid blue;
  overflow:hidden;
}
#yaxis {
   position:absolute;
   top:50.5px;
   left:322px;
   width:100px;
   height:550px;
}
#xaxis {
   position:absolute;
   top:651px;
   left:425px;
   margin:-50px auto;
   width:625px;
   height:100px;
}
.inequality {
   position:absolute;
   left:100px;
   width:265px;
   height:75px;
   font-family:'Product Sans';
   font-size:20px;
   font-variant:small-caps;
   color:brown;
}
.ineqInput {
   width:150px;
   height:35px;
   outline:none;
   font-family:'Product Sans';
   font-size:20px;
   box-sizing:border-box;
   padding:0 5px 0 5px;
}
.tstPntInput {
   width:70px;
   height:35px;
   outline:none;
   font-family:'Product Sans';
   font-size:20px;
   box-sizing:border-box;
   padding:0 5px 0 5px;
   text-align:center;
}
</style>
</head>

<body>
<div class='inequality' id='inequality1' style='top:100px;'>inequality 1:&nbsp;<input class='ineqInput' id='ineqInput1' type='text' /></p></div>
<div class='inequality' id='inequality2' style='top:200px;'>inequality 2:&nbsp;<input class='ineqInput' id='ineqInput2' type='text' /></p></div>
<div class='inequality' id='testpoint' style='top:300px;'>test point:&nbsp;&nbsp;&#8202;(<input class='tstPntInput' id='testPntX' type='text' />, <input class='tstPntInput' id='testPntY' type='text' />)</p></div>
<div style='text-align:center;'>
<div id='yaxis'></div>
<div id='demo_grapher'></div>
</div>
<div id='xaxis'></div>

<img src='https://guzintamath.com/textsavvy/wp-content/uploads/2019/01/ineqsystems.png' style='position:fixed;visibility:hidden;' />
</body>

</html>

<script>
var xandyaxes = [{x : 225, y : 400}];
var linlabels = [{x : 612, y : 413, label : 'x'}, {x : 215, y : 10, label : 'y'}];

var xScale = d3.scaleLinear()
               .domain([-9, 16])
               .range([-1, 625]);

var yScale = d3.scaleLinear()
               .domain([16, -6])
               .range([0, 550]);

var xAxis = d3.axisBottom(xScale).ticks(5);
var yAxis = d3.axisLeft(yScale).ticks(5);

var svg =  d3.select('#demo_grapher')
             .append('svg')
             .attr('width', '100%').attr('height', '100%');
var xBox = d3.select('#xaxis').append('svg')
             .attr('width', 625).attr('height', 100);
var yBox = d3.select('#yaxis').append('svg')
             .attr('width', 100).attr('height', 550);
function newGraph() {
   d3.select('#demo_grapher').selectAll('svg').remove();
   var svg = d3.select('#demo_grapher')
               .append('svg')
               .attr('width', '100%').attr('height', '100%');
   for (var a = 25; a < 625; a += 25) {
      svg.append('line')
         .attr('x1', a).attr('y1', 0).attr('x2', a).attr('y2', 600).attr('class', 'gridLine')
         .style('stroke', 'gray').style('stroke-width', 0.5).style('opacity', 1);
      svg.append('line')
         .attr('x1', 0).attr('y1', a).attr('x2', 625).attr('y2', a).attr('class', 'gridLine')
         .style('stroke', 'gray').style('stroke-width', 0.5).style('opacity', 1);
   }
   svg.selectAll('.axes')
      .data(xandyaxes)
      .enter()
      .append('line')
      .attr('class', 'axis').attr('id', 'yaxis')
      .attr('x1', function(d){return d.x;}).attr('x2', function(d){return d.x;})
      .attr('y1', 0).attr('y2', 625)
      .style('stroke', 'black').style('stroke-width', 3).style('opacity', 1);
   svg.selectAll('.axes')
      .data(xandyaxes)
      .enter()
      .append('line')
      .attr('class', 'axis').attr('id', 'xaxis')
      .attr('y1', function(d){return d.y;}).attr('y2', function(d){return d.y;})
      .attr('x1', 0).attr('x2', 625)
      .style('stroke', 'black').style('stroke-width', 3).style('opacity', 1);
   svg.selectAll('.lintext')
      .data(linlabels)
      .enter()
      .append('text')
      .attr('class', 'lintext')
      .attr('x', function(d){return d.x;})
      .attr('y', function(d){return d.y;})
      .text(function(d){return d.label;})
      .style('font-size', '14px').style('font-family', 'sans-serif')
      .style('fill', 'black').style('stroke', 'none').style('opacity', 1);

   xBox.append('g')
       .attr('transform', 'translate(0, 0)')
       .call(xAxis);
   yBox.append('g')
       .attr('transform', 'translate(100, 0)')
       .call(yAxis);
}
newGraph();
$('.tstPntInput').bind('keyup', function(evt) {
   if ($('#testPntX').val() === '' || $('#testPntY').val() === '' || isNaN($('#testPntX').val()) || isNaN($('#testPntY').val())) return;
   d3.select('#demo_grapher').select('svg').selectAll('circle').remove();
   var x = xScale(Number($('#testPntX').val()));
   var y = yScale(Number($('#testPntY').val()));
   d3.select('#demo_grapher').select('svg')
     .append('circle')
     .attr('cx', x + 0.6).attr('cy', y).attr('r', 0)
     .style('stroke', 'white').style('fill', 'yellow')
     .transition()
     .duration(1000)
     .ease(d3.easeBackOut)
     .attr('r', 8);
});
$('#ineqInput1').bind('keydown', function(evt) {
   var text = $(this).val();
   if (text.indexOf('<=') !== -1) {
   text = text.replace(/<=/g, '≤');
   }
   else if (text.indexOf('>=') !== -1) {
   text = text.replace(/>=/g, '≥');
   }
   $(this).val(text);
   if (evt.keyCode !== 13) return;
   var inxs = [{d : '<', i : text.indexOf('<')}, {d : '>', i : text.indexOf('>')}, {d : '≤', i : text.indexOf('≤')}, {d : '≥', i : text.indexOf('≥')}];
   var ind;
   var dash;
   for (inx in inxs) {
      if (inxs[inx].i !== -1) {
      ind = inxs[inx].i;
      dash = inxs[inx].d;
      break;
      }
   }
   var expression = text.slice(ind + 1, text.length);
   expression = expression.replace(/ /g, '');
   if ((expression.match(/^-?[0-9]+[x]$/)) !== null) {
      var terms = [expression, '0', 'plus'];
   }
   else if (expression.indexOf('+') !== -1) {
      var terms = expression.split('+');
      terms.push('plus');
   }
   else if (expression.indexOf('-') !== 0) {var terms = expression.split('-'); terms.push('minus');}
   else {
      var t = expression.split('-');
      var terms = ['-' + t[1], t[2], 'minus'];
   }
   if (typeof terms[1] === 'undefined') terms.splice(1, 1);
   if ((terms[1] === 'plus' || terms[1] === 'minus') && !isNaN(Number(terms[0]))) {terms.unshift('0x'); terms[2] = 'plus';}
   else if ((terms[1] === 'plus' || terms[1] === 'minus') && isNaN(terms[0])) terms.splice(1, 0, '0');
   drawLine(terms, dash, 'inequality1');
});
$('#ineqInput2').bind('keydown', function(evt) {
   var text = $(this).val();
   if (text.indexOf('<=') !== -1) {
   text = text.replace(/<=/g, '≤');
   }
   else if (text.indexOf('>=') !== -1) {
   text = text.replace(/>=/g, '≥');
   }
   $(this).val(text);
   if (evt.keyCode !== 13) return;
   var inxs = [{d : '<', i : text.indexOf('<')}, {d : '>', i : text.indexOf('>')}, {d : '≤', i : text.indexOf('≤')}, {d : '≥', i : text.indexOf('≥')}];
   var ind;
   var dash;
   for (inx in inxs) {
      if (inxs[inx].i !== -1) {
      ind = inxs[inx].i;
      dash = inxs[inx].d;
      break;
      }
   }
   var expression = text.slice(ind + 1, text.length);
   expression = expression.replace(/ /g, '');
   if ((expression.match(/^-?[0-9]+[x]$/)) !== null) {
      var terms = [expression, '0', 'plus'];
   }
   else if (expression.indexOf('+') !== -1) {
      var terms = expression.split('+');
      terms.push('plus');
   }
   else if (expression.indexOf('-') !== 0) {var terms = expression.split('-'); terms.push('minus');}
   else {
      var t = expression.split('-');
      var terms = ['-' + t[1], t[2], 'minus'];
   }
   if (typeof terms[1] === 'undefined') terms.splice(1, 1);
   if ((terms[1] === 'plus' || terms[1] === 'minus') && !isNaN(Number(terms[0]))) {terms.unshift('0x'); terms[2] = 'plus';}
   else if ((terms[1] === 'plus' || terms[1] === 'minus') && isNaN(terms[0])) terms.splice(1, 0, '0');
   drawLine(terms, dash, 'inequality2');
});

function drawLine(tms, dsh, clss) {
   if (dsh === '<' || dsh === '>') var dsharr = '5, 5';
   else var dsharr = '1, 0';
   if (tms[0].indexOf('x') === -1) var slope = 0;
   else if (tms[0].slice(0, tms[0].indexOf('x')) === '') var slope = 1;
   else if (tms[0].slice(0, tms[0].indexOf('-x')) === '') var slope = -1;
   else var slope = Number(tms[0].slice(0, tms[0].indexOf('x')));
   var intcp = yScale(Number(tms[1])) - yScale(0);
   if (tms[2] === 'minus') intcp = -intcp;
   var startPointY = yScale(-10 * slope);
   var endPointY = yScale(17 * slope);

   if (dsh === '<' || dsh === '≤') {
      d3.select('#demo_grapher').select('svg').selectAll('.' + clss).remove();
      d3.select('#demo_grapher').select('svg').append('path')
        .attr('class', clss)
        .attr('d', 'M -26.04 ' + String(startPointY) + ' L -26.04 ' + String(560 - intcp) + ' L 650.04 ' + String(560 - intcp) + ' L 650.04 ' + String(endPointY) + 'Z')
        .style('stroke', 'black').style('stroke-width', 2).style('fill', 'rgba(255, 0, 0, 0.3)').style('stroke-dasharray', dsharr)
        .attr('transform', 'translate(0, ' + String(intcp) + ')');
   }
   else if (dsh === '>' || dsh === '≥') {
      d3.select('#demo_grapher').select('svg').selectAll('.' + clss).remove();
      d3.select('#demo_grapher').select('svg').append('path')
        .attr('class', clss)
        .attr('d', 'M -26.04 ' + String(startPointY) + ' L -26.04 ' + String(-10 - intcp) + ' L 650.04 ' + String(-10 - intcp) + ' L 650.04 ' + String(endPointY) + 'Z')
        .style('stroke', 'black').style('stroke-width', 2).style('fill', 'rgba(0, 0, 255, 0.3)').style('stroke-dasharray', dsharr)
        .attr('transform', 'translate(0, ' + String(intcp) + ')');
   }
}
</script>
